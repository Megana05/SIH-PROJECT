<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Driver Web</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    body {
      font-family:'Segoe UI',Arial,sans-serif;
      background:#6cc5b3; /* Teal main background */
      min-height:100vh;
      margin:0;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .card {
      background:#c5edef;
      border-radius:12px;
      padding:28px;
      width:380px;
      max-width:96vw;
      box-shadow:0 8px 25px rgba(0,0,0,.15);
      animation:fadeIn .6s;
    }
    @keyframes fadeIn {from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
    h2 {
      color:#075a5a; /* Dark teal/blue heading */
      margin:0 0 12px;
      font-weight:700;
    }
    input,button {
      width:90%;
      padding:12px;
      margin:10px 0;
      border-radius:8px;
      border:1px solid #ccc;
      font-size:1rem;
    }
    button {
      border:none;
      background:#10929e; /* Dark blue button */
      color:#fff;
      font-weight:600;
      cursor:pointer;
      transition:0.3s;
    }
    button:hover {
      background:#34495e; /* hover effect */
    }
    #tripStatus.green{color:#2e7d32;font-weight:700}
    #tripStatus.red{color:#c62828;font-weight:700}
    #map{height:300px;border-radius:10px;margin-top:12px}
    .sos-row{margin:10px 0}
    a{color:#1abc9c;text-decoration:none;}
    a:hover{text-decoration:underline;}
    @media(max-width:500px){
      .card{width:96vw;padding:18px}
      #map{height:200px}
    }
  </style>
</head>
<body>

<!-- Welcome -->
<div id="welcome" class="card">
  <h2><i class="fa-solid fa-bus"></i> Welcome, Driver!</h2>
  <p style="color:#555">Ready to start your journey?</p>
  <button onclick="showLogin()"><i class="fa-solid fa-arrow-right"></i> Get Started</button>
</div>

<!-- Login -->
<div id="login" class="card" style="display:none">
  <h2><i class="fa-solid fa-user"></i> Driver Login</h2>
  <input id="driverId" placeholder="Enter Driver ID" />
  <input id="password" type="password" placeholder="Password" />
  <button onclick="login()"><i class="fa-solid fa-sign-in-alt"></i> Login</button>
  <p id="loginStatus" style="color:#c62828;min-height:20px"></p>
</div>

<!-- Profile -->
<div id="profile" class="card" style="display:none">
  <h2><i class="fa-solid fa-id-card"></i> Profile</h2>
  <div id="profileInfo" style="background:#f5f5f5;padding:12px;border-radius:8px;margin:12px 0"></div>
  <button onclick="showOptions()"><i class="fa-solid fa-arrow-right"></i> Continue</button>
</div>

<!-- Options -->
<div id="options" class="card" style="display:none">
  <h2><i class="fa-solid fa-route"></i> Trip Options</h2>
  <div id="tripStatus" class="red">üöç Status: Not Started</div>
  <button onclick="startTrip()"><i class="fa-solid fa-play"></i> Start Trip</button>
  <button onclick="endTrip()"><i class="fa-solid fa-stop"></i> End Trip</button>
  <button onclick="toggleSOS()"><i class="fa-solid fa-triangle-exclamation"></i> SOS</button>
  <button onclick="logout()"><i class="fa-solid fa-right-from-bracket"></i> Logout</button>
  <div id="status" style="min-height:22px;margin-top:8px;color:#2e7d32"></div>
  <div id="map"></div>
</div>

<!-- SOS -->
<div id="sosBox" style="display:none; position:fixed; left:12px; right:12px; bottom:18px; z-index:1000;">
  <div id="sos" class="card">
    <h3 style="color:#e53935; margin:0 0 8px;"><i class="fa-solid fa-triangle-exclamation"></i> Emergency Numbers</h3>
    <div class="sos-row"><i class="fa-solid fa-shield-halved"></i> <a href="tel:100">Police: 100</a></div>
    <div class="sos-row"><i class="fa-solid fa-truck-medical"></i> <a href="tel:108">Ambulance: 108</a></div>
    <div class="sos-row"><i class="fa-solid fa-fire-extinguisher"></i> <a href="tel:101">Fire: 101</a></div>
    <button onclick="closeSOS()" style="margin-top:12px; background:#e53935; color:#fff;">Close</button>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  // UI Functions
  function showLogin(){document.getElementById('welcome').style.display='none';document.getElementById('login').style.display='block'}
  function login(){
    const driverId=document.getElementById('driverId').value.trim();
    const pwd=document.getElementById('password').value.trim();
    if(!driverId||!pwd){document.getElementById('loginStatus').innerText='Enter Driver ID and Password';return;}
    document.getElementById('login').style.display='none';
    document.getElementById('profile').style.display='block';
    document.getElementById('profileInfo').innerHTML=`<strong>Driver ID:</strong> ${driverId}<br><strong>Name:</strong> John Doe<br><strong>Vehicle:</strong> TN01AB1234`;
  }
  function showOptions(){document.getElementById('profile').style.display='none';document.getElementById('options').style.display='block'; if(!mapInited) initMap();}
  function logout(){endTrip();document.getElementById('options').style.display='none';document.getElementById('profile').style.display='none';document.getElementById('login').style.display='block'; document.getElementById('tripStatus').innerText='üöç Status: Not Started'; document.getElementById('tripStatus').className='red'}
  
  // SOS Functions
  function toggleSOS(){document.getElementById('sosBox').style.display = (document.getElementById('sosBox').style.display==='none'?'block':'none');}
  function closeSOS(){document.getElementById('sosBox').style.display='none';}

  // Trip & Map
  let tripInterval=null, routeIndex=0;
  const route=[
    {lat:13.08698,lon:80.28763},{lat:13.0800,lon:80.2800},{lat:13.0805,lon:80.2790},{lat:13.0810,lon:80.2785},
    {lat:13.0820,lon:80.2775},{lat:13.0830,lon:80.2765},{lat:13.0840,lon:80.2750},{lat:13.0850,lon:80.2740},
    {lat:13.0860,lon:80.2730},{lat:13.0741,lon:80.2326}
  ];
  let map, marker, mapInited=false;
  function initMap(){
    mapInited=true;
    map=L.map('map').setView([13.0800,80.2767],14);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; OpenStreetMap contributors'}).addTo(map);
    marker=L.marker([13.0800,80.2767]).addTo(map).bindPopup('Bus location');
  }

  function startTrip(){
    const driverId=document.getElementById('driverId').value.trim();
    if(!driverId){document.getElementById('status').innerText='Driver ID missing!';return;}
    document.getElementById('status').innerText='Trip started. Sending location...';
    document.getElementById('tripStatus').innerText='üöç Status: On Trip'; document.getElementById('tripStatus').className='green';
    if(!mapInited) initMap();
    if(tripInterval) return;
    routeIndex=0;
    sendLocationPoint();
    tripInterval=setInterval(()=> {
      if(routeIndex>=route.length){ endTrip(); return; }
      sendLocationPoint();
    },5000);
  }

  function sendLocationPoint(){
    const driverId=document.getElementById('driverId').value.trim();
    const point=route[routeIndex]||route[route.length-1];
    const payload={ driverId, latitude: point.lat, longitude: point.lon, status: "On Trip" };
    fetch("http://localhost:5000/updateLocation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)}).catch(()=>{document.getElementById('status').innerText='Error sending location!';});
    marker.setLatLng([point.lat, point.lon]);
    map.setView([point.lat, point.lon]);
    routeIndex++;
  }

  function endTrip(){
    if(tripInterval){ clearInterval(tripInterval); tripInterval=null; }
    document.getElementById('status').innerText='Trip ended. Location sharing stopped.';
    document.getElementById('tripStatus').innerText='üöç Status: Stopped'; document.getElementById('tripStatus').className='red';
    if(marker){
      const latlng=marker.getLatLng();
      const payload={ driverId: document.getElementById('driverId').value.trim(), latitude: latlng.lat, longitude: latlng.lng, status: "Stopped" };
      fetch("http://localhost:5000/updateLocation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)}).catch(()=>{});
    }
  }

  // initial state
  document.getElementById('welcome').style.display='block';
  document.getElementById('login').style.display='none';
  document.getElementById('profile').style.display='none';
  document.getElementById('options').style.display='none';
  document.getElementById('sosBox').style.display='none';
</script>
</body>
</html>
